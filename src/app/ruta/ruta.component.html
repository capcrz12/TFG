<script src='https://cdn.maptiler.com/maplibre-gl-js/v2.2.0-pre.2/maplibre-gl.js'></script>
<link href='https://cdn.maptiler.com/maplibre-gl-js/v2.2.0-pre.2/maplibre-gl.css' rel='stylesheet' />
<link href='https://cdn.maptiler.com/maplibre-gl-js/v2.2.0-pre.2/maplibre-gl.css' rel='stylesheet' />
<script src="https://cdn.maptiler.com/maptiler-sdk-js/v1.2.0/maptiler-sdk.umd.js"></script>

<div id="map"></div>
<script type="module">
    const API_KEY='xkstedU79vEq8uEaVE2A';
    const map = new maplibregl.Map({
        container: 'map',
        style: `https://api.maptiler.com/maps/winter-v2/style.json?key=${API_KEY}`, // Meter el código key en una variable de entorno
        center: [-3.60667, 37.18817],                                                          // Obtenida de https://cloud.maptiler.com/account/keys/?_gl=1*k6p42y*_gcl_au*NTg1ODEwMzYwLjE3MTAzNDk1ODc.*_ga*MTUwNDQ3NTA2MS4xNzEwMzQ5NTg4*_ga_K4SXYBF4HT*MTcxMDM0OTU4Ny4xLjEuMTcxMDM1MDAwNi42MC4wLjA.
        zoom: 12,
        pitch: 50,
        maxPitch: 85
    });

    // Añadimos una capa nueva para introducir el raster 3D
    map.on('load', () => {
        // Add new sources and layers
        map.addSource("terrain", {
            "type": "raster-dem",
            "url": `https://api.maptiler.com/tiles/terrain-rgb-v2/tiles.json?key=${API_KEY}`
            });
        map.setTerrain({
            source: "terrain"
        });
    });

    // Marcador
    const london = new maplibregl.Marker()
        .setLngLat([0.11, 51.49])
        .addTo(map);

    map.on('error', function(err) {
        throw new Error("To load the map, you must replace YOUR_MAPTILER_API_KEY_HERE first, see README");
    });

    map.on('load', () => {
        maptilersdk.helpers.addPolyline(map, {
        data: 'https://docs.maptiler.com/sdk-js/examples/helper-polyline-gpx/run.gpx',
        outline: true
        });
    });
    map.on('load', () => {
        maptilersdk.helpers.addPolyline(map, {
            data: 'http://localhost:8000/server.php',
            outline: true 
        });
    });
</script>